arguments: src/align_dataset_mtcnn.py Dataset/FaceData/raw Dataset/FaceData/processed --image_size 160 --margin 32 --random_order --gpu_memory_fraction 0.25
--------------------
tensorflow version: 2.15.0
--------------------
git hash: b'533409690ccf7b33d810b28c14a91d1ba74a8d54'
--------------------
b'diff --git a/BackEnd/app/app.py b/BackEnd/app/app.py\nindex f9b6b0a..6f0b8c6 100644\n--- a/BackEnd/app/app.py\n+++ b/BackEnd/app/app.py\n@@ -1,14 +1,21 @@\n-from fastapi import FastAPI, HTTPException, Request\n+from fastapi import FastAPI, HTTPException, Request, Form\n from typing import Optional, List\n+from fastapi.responses import JSONResponse\n import pyodbc\n import jwt\n+import align.detect_face\n+import numpy as np\n from datetime import datetime, timedelta\n from fastapi.middleware.cors import CORSMiddleware\n+from fastapi import File, UploadFile\n from pydantic import BaseModel\n-\n+import cv2\n+from FaceRecognitionCamera import FaceRecognitionCamera\n+import base64\n SECRET_KEY = "duycao12"\n TOKEN_EXPIRE_MINUTES = 30\n \n+\n class User:\n     def __init__(self, username: str, password: str,role:str):\n         self.username = username\n@@ -36,7 +43,6 @@ def connect_to_database():\n                           \'UID=sa;\'\n                           \'PWD=123456\')\n \n-\n def get_user_by_username(username: str) -> Optional[User]:\n     connection = connect_to_database()\n     cursor = connection.cursor()\n@@ -334,6 +340,20 @@ async def get_ListSubject(MaGV : str,HocKy: str,Nam: str,MaMon:str,MaLop:str ):\n     except Exception as e:\n         raise HTTPException(status_code=500, detail=str(e))\n     \n+face_recognition = FaceRecognitionCamera()\n+@app.post("/face-recognition")\n+async def upload_image(request: Request,  image_data: dict=None):\n+    if image_data and "image_data" in image_data:\n+        image_data = base64.b64decode(image_data["image_data"].split(",")[1])\n+        nparr = np.frombuffer(image_data, np.uint8)\n+        image = cv2.imdecode(nparr, cv2.IMREAD_COLOR)\n+        faces = face_recognition.detect_faces(image)\n+\n+    # Tr\xe1\xba\xa3 v\xe1\xbb\x81 k\xe1\xba\xbft qu\xe1\xba\xa3\n+        return faces\n+    else:\n+        return JSONResponse(content={"message": "No image data received"}, status_code=400)\n+\n if __name__ == "__main__":\n     import uvicorn\n     uvicorn.run(app, host="127.0.0.1", port=8000)\n\\ No newline at end of file\ndiff --git a/demo/package-lock.json b/demo/package-lock.json\nindex f106d5e..d0baf70 100644\n--- a/demo/package-lock.json\n+++ b/demo/package-lock.json\n@@ -17,7 +17,7 @@\n         "@testing-library/user-event": "^13.5.0",\n         "@toast-ui/react-calendar": "^2.1.3",\n         "antd": "^5.18.0",\n-        "axios": "^1.6.8",\n+        "axios": "^1.7.2",\n         "bootstrap": "^5.3.3",\n         "date-fns": "^3.6.0",\n         "file-saver": "^2.0.5",\n@@ -34,6 +34,7 @@\n         "react-router-dom": "^6.23.1",\n         "react-scripts": "5.0.1",\n         "react-tooltip": "^5.26.4",\n+        "react-webcam": "^7.2.0",\n         "tui-calendar": "^1.15.3",\n         "web-vitals": "^2.1.4",\n         "xlsx": "^0.18.5"\n@@ -5977,9 +5978,9 @@\n       }\n     },\n     "node_modules/axios": {\n-      "version": "1.6.8",\n-      "resolved": "https://registry.npmjs.org/axios/-/axios-1.6.8.tgz",\n-      "integrity": "sha512-v/ZHtJDU39mDpyBoFVkETcd/uNdxrWRrg3bKpOKzXFA6Bvqopts6ALSMU3y6ijYxbw2B+wPrIv46egTzJXCLGQ==",\n+      "version": "1.7.2",\n+      "resolved": "https://registry.npmjs.org/axios/-/axios-1.7.2.tgz",\n+      "integrity": "sha512-2A8QhOMrbomlDuiLeK9XibIBzuHeRcqqNOHp0Cyp5EoJ1IFDh+XZH3A6BkXtv0K4gFGCI0Y4BM7B1wOEi0Rmgw==",\n       "dependencies": {\n         "follow-redirects": "^1.15.6",\n         "form-data": "^4.0.0",\n@@ -18665,6 +18666,15 @@\n         "react-dom": ">=16.14.0"\n       }\n     },\n+    "node_modules/react-webcam": {\n+      "version": "7.2.0",\n+      "resolved": "https://registry.npmjs.org/react-webcam/-/react-webcam-7.2.0.tgz",\n+      "integrity": "sha512-xkrzYPqa1ag2DP+2Q/kLKBmCIfEx49bVdgCCCcZf88oF+0NPEbkwYk3/s/C7Zy0mhM8k+hpdNkBLzxg8H0aWcg==",\n+      "peerDependencies": {\n+        "react": ">=16.2.0",\n+        "react-dom": ">=16.2.0"\n+      }\n+    },\n     "node_modules/read-cache": {\n       "version": "1.0.0",\n       "resolved": "https://registry.npmjs.org/read-cache/-/read-cache-1.0.0.tgz",\ndiff --git a/demo/package.json b/demo/package.json\nindex ab2b331..8defd71 100644\n--- a/demo/package.json\n+++ b/demo/package.json\n@@ -12,7 +12,7 @@\n     "@testing-library/user-event": "^13.5.0",\n     "@toast-ui/react-calendar": "^2.1.3",\n     "antd": "^5.18.0",\n-    "axios": "^1.6.8",\n+    "axios": "^1.7.2",\n     "bootstrap": "^5.3.3",\n     "date-fns": "^3.6.0",\n     "file-saver": "^2.0.5",\n@@ -29,6 +29,7 @@\n     "react-router-dom": "^6.23.1",\n     "react-scripts": "5.0.1",\n     "react-tooltip": "^5.26.4",\n+    "react-webcam": "^7.2.0",\n     "tui-calendar": "^1.15.3",\n     "web-vitals": "^2.1.4",\n     "xlsx": "^0.18.5"\ndiff --git a/demo/src/Page/Class/ListStuDIem/index.js b/demo/src/Page/Class/ListStuDIem/index.js\nindex f4c0252..bb84de1 100644\n--- a/demo/src/Page/Class/ListStuDIem/index.js\n+++ b/demo/src/Page/Class/ListStuDIem/index.js\n@@ -61,7 +61,7 @@ const ListStu = ({ MaGV, HocKy, Nam }) => {\n             },\n         ];\n \n-        const monHocFields = [\'TenMon\', \'MaMon\', \'BuoiHoc\', \'DiemDanh\'];\n+        const monHocFields = [\'TenMon\', \'MaMon\', \'BuoiHoc\', \'DiemDanh\',];\n \n         monHocFields.forEach(field => {\n             columns.push({\n@@ -69,19 +69,50 @@ const ListStu = ({ MaGV, HocKy, Nam }) => {\n                 dataIndex: field,\n                 key: field,\n                 render: (text, record) => {\n-                    return (\n+                         return (\n                         <ul>\n                             {record.MonHocDetails.map((monHoc, index) => (\n-                                <p key={index}>{monHoc[field]}</p>\n+                                <p key={index}>\n+                                     {field === \'DiemDanh\' && monHoc[field] === \'0\' ? \'Kh\xc3\xb4ng h\xe1\xbb\x8dc bu\xe1\xbb\x95i n\xc3\xa0o\' : monHoc[field]}\n+                                     </p>\n                             ))}\n                         </ul>\n                     );\n+                    \n                 }\n             });\n         });\n \n         return columns;\n     };\n+    const processedDataWithComments = data.map(student => {\n+        let totalAbsent = 0;\n+        let totalAttended = 0;\n+    \n+        student.MonHocDetails.forEach(detail => {\n+            if (detail.DiemDanh === \'0\') {\n+                totalAbsent++;\n+            } else {\n+                totalAttended++;\n+            }\n+        });\n+    \n+        let comment = \'\';\n+        if (totalAttended === 0 && totalAbsent === 0) {\n+            comment = \'Ch\xc6\xb0a \xc4\x91i h\xe1\xbb\x8dc\';\n+        } else if (totalAttended === 0 && totalAbsent > 0) {\n+            comment = \'Ngh\xe1\xbb\x89 h\xe1\xbb\x8dc\';\n+        } else if (totalAbsent === 0) {\n+            comment = \'\xc4\x90i h\xe1\xba\xbft bu\xe1\xbb\x95i\';\n+        } else {\n+            comment = `V\xe1\xba\xafng ${totalAbsent} bu\xe1\xbb\x95i`;\n+        }\n+    \n+        return {\n+            ...student,\n+            Comment: comment\n+        };\n+    });\n     const exportToExcel = () => {\n         const headers = [\n             "M\xc3\xa3 SV",\n@@ -89,25 +120,30 @@ const ListStu = ({ MaGV, HocKy, Nam }) => {\n             "T\xc3\xaan m\xc3\xb4n",\n             "M\xc3\xa3 m\xc3\xb4n",\n             "Bu\xe1\xbb\x95i h\xe1\xbb\x8dc",\n-            "\xc4\x90i\xe1\xbb\x83m danh"\n+            "\xc4\x90i\xe1\xbb\x83m danh",\n+            "Nh\xe1\xba\xadn x\xc3\xa9t"\n         ];\n \n         // T\xe1\xba\xa1o m\xe1\xbb\x99t \xc4\x91\xe1\xbb\x91i t\xc6\xb0\xe1\xbb\xa3ng d\xc3\xb9ng \xc4\x91\xe1\xbb\x83 l\xc6\xb0u tr\xe1\xbb\xaf d\xe1\xbb\xaf li\xe1\xbb\x87u \xc4\x91\xc6\xb0\xe1\xbb\xa3c g\xe1\xbb\x99p\n         const mergedData = {};\n \n         // Duy\xe1\xbb\x87t qua d\xe1\xbb\xaf li\xe1\xbb\x87u v\xc3\xa0 g\xe1\xbb\x99p c\xc3\xa1c m\xc3\xb4n h\xe1\xbb\x8dc c\xe1\xbb\xa7a c\xc3\xb9ng m\xe1\xbb\x99t sinh vi\xc3\xaan\n-        data.forEach(student => {\n+        processedDataWithComments.forEach(student => {\n             const key = `${student.MaSV}-${student.name}`;\n             if (!mergedData[key]) {\n                 mergedData[key] = {\n                     MaSV: student.MaSV,\n                     name: student.name,\n-                    MonHoc: []\n+                    MonHoc: [],\n                 };\n             }\n             student.MonHocDetails.forEach(detail => {\n+                if (detail.DiemDanh === \'0\') {\n+                    detail.DiemDanh = \'Kh\xc3\xb4ng h\xe1\xbb\x8dc bu\xe1\xbb\x95i n\xc3\xa0o\';\n+                }\n                 mergedData[key].MonHoc.push(detail);\n             });\n+            mergedData[key].Comment = student.Comment; \n         });\n \n         // Chuy\xe1\xbb\x83n \xc4\x91\xe1\xbb\x95i d\xe1\xbb\xaf li\xe1\xbb\x87u \xc4\x91\xc3\xa3 g\xe1\xbb\x99p sang \xc4\x91\xe1\xbb\x8bnh d\xe1\xba\xa1ng cho file Excel\n@@ -120,7 +156,8 @@ const ListStu = ({ MaGV, HocKy, Nam }) => {\n                     detail.TenMon,\n                     detail.MaMon,\n                     detail.BuoiHoc,\n-                    detail.DiemDanh\n+                    detail.DiemDanh,\n+                    detail.Comment\n                 ]);\n             }).flat()\n         ];\n@@ -156,7 +193,7 @@ const ListStu = ({ MaGV, HocKy, Nam }) => {\n \n     return (\n         <div>\n-            <h1>Danh s\xc3\xa1ch \xc4\x91i h\xe1\xbb\x8dc t\xe1\xbb\xabng m\xc3\xb4n {HocKy} n\xc4\x83m {Nam} </h1>\n+            <h1 style={{ fontFamily: \'cursive\',margin:\'0 0 10px 0\',textAlign:\'center\' }}>Danh s\xc3\xa1ch sinh vi\xc3\xaan \xc4\x91i h\xe1\xbb\x8dc  </h1>\n             <ReusableTable columns={columns} data={data} loading={loading} />\n             <Button onClick={exportToExcel} type="primary" style={{ margin: 16, backgroundColor: "green" }}>\n                 <FaFileExport /> Xu\xe1\xba\xa5t file\ndiff --git a/demo/src/Page/Class/index.js b/demo/src/Page/Class/index.js\nindex 5aa0ddf..08ca456 100644\n--- a/demo/src/Page/Class/index.js\n+++ b/demo/src/Page/Class/index.js\n@@ -5,6 +5,7 @@ import { format } from \'date-fns\';\n import { Select, Button } from \'antd\';\n import getListHK from "../../common/Api/ApiHK"; \n import ListStu from "./ListStuDIem";\n+import \'./style.css\'\n const { Option } = Select;\n \n const Class = () => {\n@@ -107,7 +108,7 @@ const Class = () => {\n                             <Button type="primary" onClick={handleButtonClick}>Xu\xe1\xba\xa5t danh s\xc3\xa1ch</Button>\n                         </div>\n                         {showExportInfo ? (\n-                            <div style={{ padding: \'16px\', background: \'#f0f0f0\', marginBottom: \'16px\' }}>\n+                            <div style={{ padding: \'16px\', background: \'white\', marginBottom: \'16px\' }}>\n                                 <ListStu MaGV={localStorage.getItem(\'username\')} HocKy = {selectedHocKy} Nam={selectedNamHoc}></ListStu>\n                                 <Button type="primary" onClick={hideExportInfoPanel}>\xc4\x90\xc3\xb3ng</Button>\n                             </div>\ndiff --git a/demo/src/Page/Default-page/index.js b/demo/src/Page/Default-page/index.js\nindex a0f01b0..6014b61 100644\n--- a/demo/src/Page/Default-page/index.js\n+++ b/demo/src/Page/Default-page/index.js\n@@ -3,6 +3,7 @@ import { useEffect, useState } from "react"\n import { Select, Button } from \'antd\';\n import getSubject from "../../common/Api/ApiGetSubject";\n import getListSubject from "../../common/Api/ApigetListSubject";\n+import ReusableTable from "../../common/component/AntTable";\n const Default_page=()=>{\n     const { Option } = Select;\n     const role = localStorage.getItem(\'chuc vu\')\n@@ -44,7 +45,12 @@ const Default_page=()=>{\n     const fetchListSubject = async()=>{\n         try{\n             const dataList  =await getListSubject(username,selectedHocKy,selectedNamHoc,selectedClassCode,selectedSubjectCode)\n-            setDatalist(dataList)\n+            const processedData = dataList.map(item => ({\n+                ...item,\n+                SoBuoiHoc: item.SoBuoiHoc === null ? 0 : item.SoBuoiHoc,\n+                BuoiDiemdanh: item.BuoiDiemdanh === null ? \'Kh\xc3\xb4ng h\xe1\xbb\x8dc bu\xe1\xbb\x95i n\xc3\xa0o\' : item.BuoiDiemdanh\n+            }));\n+            setDatalist(processedData)\n         }catch(error){\n             console.log(error);\n         }\n@@ -75,11 +81,36 @@ const Default_page=()=>{\n         setSelectedSubjectCode(selectedSubject.maMon);\n     }\n         };\n-    \n+    const columns = [\n+        {\n+            title: \'M\xc3\xa3 SV\',\n+                dataIndex: \'MaSV\',\n+                key: \'MaSV\',\n+        },{\n+                title: \'H\xe1\xbb\x8d v\xc3\xa0 t\xc3\xaan\',\n+                dataIndex: \'name\',\n+                key: \'name\',\n+        },\n+        {\n+            title: \'M\xc3\xb4n h\xe1\xbb\x8dc\',\n+            dataIndex: \'TenMon\',\n+            key: \'TenMon\',\n+        },\n+        {\n+            title: \'S\xe1\xbb\x91 bu\xe1\xbb\x95i h\xe1\xbb\x8dc\',\n+            dataIndex: \'SoBuoiHoc\',\n+            key: \'SoBuoiHoc\',\n+        },\n+        {\n+            title: \'S\xe1\xbb\x91 bu\xe1\xbb\x95i \xc4\x91i h\xe1\xbb\x8dc\',\n+            dataIndex: \'BuoiDiemdanh\',\n+            key: \'BuoiDiemdanh\',\n+        },\n+    ]\n     return(\n         <>\n-       <h1>Danh s\xc3\xa1ch m\xc3\xb4n h\xe1\xbb\x8dc k\xe1\xbb\xb3 n\xc3\xa0y</h1> \n-       <div style={{ marginBottom: \'16px\' }}>\n+       <h1 style={{ fontFamily: \'cursive\',margin:\'0\' }}>Danh s\xc3\xa1ch m\xc3\xb4n h\xe1\xbb\x8dc k\xe1\xbb\xb3 n\xc3\xa0y</h1> \n+       <div style={{ marginBottom: \'16px\',marginTop:\'10px\' }}>\n                             <Select style={{ width: \'200px\', marginRight: \'8px\' }} placeholder="Ch\xe1\xbb\x8dn h\xe1\xbb\x8dc k\xe1\xbb\xb3" \n                             onChange={value => setSelectedHocKy(value)}>\n                                 {hockyOptions.map(option => (\n@@ -93,8 +124,7 @@ const Default_page=()=>{\n                                 ))}\n                             </Select>\n                             {subjects.length > 0 && (\n-                <div>\n-                    <h2>C\xc3\xa1c m\xc3\xb4n h\xe1\xbb\x8dc:</h2>\n+                <div style={{ marginTop: \'10px\' }}>\n                     <Select\n                         style={{ width: \'400px\', marginRight: \'8px\' }}\n                         placeholder="Ch\xe1\xbb\x8dn m\xc3\xb4n h\xe1\xbb\x8dc"\n@@ -107,7 +137,7 @@ const Default_page=()=>{\n                         ))}\n                     </Select>\n                     <Select\n-                        style={{ width: \'400px\', marginRight: \'8px\' }}\n+                        style={{ width: \'400px\', marginRight: \'8px\' ,marginBottom:\'8px\' }}\n                         placeholder="Ch\xe1\xbb\x8dn m\xc3\xa3 l\xe1\xbb\x9bp"\n                         onChange={value => setSelectedClassCode(value)}\n                         disabled={!selectedSubjectName}\n@@ -119,6 +149,7 @@ const Default_page=()=>{\n                             </Option>\n                         ))}\n                     </Select>\n+                    <ReusableTable columns={columns} data={listData}></ReusableTable>\n                 </div>\n             )}\n          </div>\ndiff --git a/demo/src/Page/DiemDanh/index.js b/demo/src/Page/DiemDanh/index.js\nindex 2f74921..0528ad9 100644\n--- a/demo/src/Page/DiemDanh/index.js\n+++ b/demo/src/Page/DiemDanh/index.js\n@@ -1,35 +1,73 @@\n-import React from \'react\';\n-\n-const StudentTable = () => {\n-  return (\n-    <table style={{ borderCollapse: \'collapse\', width: \'100%\' }}>\n-      <thead>\n-        <tr>\n-          <th style={styles.tableCell}>M\xc3\xa3 sinh vi\xc3\xaan</th>\n-          <th style={styles.tableCell}>H\xe1\xbb\x8d v\xc3\xa0 t\xc3\xaan</th>\n-          <th style={styles.tableCell}>M\xc3\xb4n h\xe1\xbb\x8dc</th>\n-        </tr>\n-      </thead>\n-      <tbody>\n-        <tr>\n-          <td style={styles.tableCell} rowSpan="2">K205480106005</td>\n-          <td style={styles.tableCell} rowSpan="2">Nguy\xe1\xbb\x85n Duy Cao</td>\n-          <td style={styles.tableCell}>L\xe1\xba\xadp tr\xc3\xacnh Python (TEE0480)</td>\n-        </tr>\n-        <tr>\n-          <td style={styles.tableCell}>TEE0479</td>\n-        </tr>\n-      </tbody>\n-    </table>\n-  );\n-};\n+import React, { useRef, useState,useEffect } from \'react\';\n+import axios from \'axios\';\n+\n+const FaceRecognition = () => {\n+    const videoRef = useRef(null);\n+    const canvasRef = useRef(null);\n+    const [faces, setFaces] = useState([]);\n+\n+    useEffect(() => {\n+      // G\xe1\xbb\x8di detectFaces() khi component \xc4\x91\xc6\xb0\xe1\xbb\xa3c render l\xe1\xba\xa1i\n+      detectFaces();\n+  }, []);\n+    const startVideo = () => {\n+        navigator.mediaDevices.getUserMedia({ video: true })\n+            .then((stream) => {\n+                if (videoRef.current) {\n+                    videoRef.current.srcObject = stream;\n+                }\n+            })\n+            .catch((err) => console.error(\'Error accessing media devices:\', err));\n+    };\n+\n+    const stopVideo = () => {\n+        const stream = videoRef.current.srcObject;\n+        if (stream) {\n+            const tracks = stream.getTracks();\n+            tracks.forEach((track) => track.stop());\n+        }\n+    };\n+\n+    const detectFaces = async () => {\n+        const video = videoRef.current;\n+        const canvas = canvasRef.current;\n+        const context = canvas.getContext(\'2d\');\n+\n+        context.drawImage(video, 0, 0, canvas.width, canvas.height);\n+        const imageData = canvas.toDataURL(\'image/jpeg\');\n+\n+       \n+          const response = await axios.post(\'http://localhost:8000/face-recognition\', { image_data: imageData });\n+            setFaces(response.data);\n+            console.log(\'API Response:\', response.data);\n+            if (response.data.detected_faces) {\n+              response.data.detected_faces.forEach((face, index) => {\n+                  console.log(`Face ${index + 1}: Name - ${face.name}, Detectf - ${face.detectf}`);\n+              });\n+          }\n+          \n+         \n+    };\n+    console.log("Face: ",faces);\n \n-const styles = {\n-  tableCell: {\n-    border: \'1px solid black\',\n-    padding: \'8px\',\n-    textAlign: \'left\',\n-  }\n+    return (\n+        <div>\n+            <button onClick={startVideo}>Start Video</button>\n+            <button onClick={stopVideo}>Stop Video</button>\n+            <button onClick={detectFaces}>Detect Faces</button>\n+            <video ref={videoRef} autoPlay muted />\n+            <canvas ref={canvasRef} />\n+            {faces && faces.length > 0 && (\n+    <div>\n+        {faces.map((face, index) => (\n+            <div key={index}>\n+                <p> Name - {face}</p>\n+            </div>\n+        ))}\n+    </div>\n+)}\n+        </div>\n+    );\n };\n \n-export default StudentTable;\n+export default FaceRecognition;'